<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Łazik kosmiczny</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #f7f7f7;
      margin: 0;
      padding: 20px;
    }
    canvas {
      border: 2px solid #444;
      margin-top: 20px;
      background: white;
    }
    input, button, select {
      margin: 5px;
      padding: 5px;
    }
  </style>
</head>
<body>
  <h1>Łazik kosmiczny</h1>
  <label>Liczba wierszy (n): <input type="number" id="rows" value="5" required></label>
  <label>Liczba kolumn (m): <input type="number" id="cols" value="4" required></label>
  <br>
  <label>Instrukcje: <input type="text" id="instructions" style="min-width: 250px" value="PPPDDDLLGPGLLDDDPPP" required></label>
  <br>
  <label>Prędkość:
    <select id="speed">
      <option value="2000">Bardzo wolna</option>
      <option value="1000">Wolna</option>
      <option value="200" selected>Normalna</option>
      <option value="100">Szybka</option>
      <option value="30">Bardzo szybka</option>
      <option value="0">Najszybsza</option>
    </select>
  </label>
  <button onclick="startAnimation()">Zacznij/wznów animację</button>
  <button onclick="stopAnimation()">Wstrzymaj animację</button>
  <button onclick="manualStepForward()">Zrób krok</button>
  <button onclick="stepBackward()">Cofnij krok</button>
  <button onclick="resetAnimation()">Zresetuj animację</button>
  <br>
  <canvas id="gridCanvas" width="800" height="800"></canvas>

  <script>
    const canvas = document.getElementById('gridCanvas');
    const ctx = canvas.getContext('2d');

    let n, m, instructions;
    let visited = [{x: 0, y: 0}];
    let animationId = null;
    let delay = 500;

    function drawGrid() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      let cellW = canvas.width / m;
      let cellH = canvas.height / n;

      // Draw grid lines
      ctx.strokeStyle = '#ccc';
      for (let i = 0; i <= n; i++) {
        ctx.beginPath();
        ctx.moveTo(0, i * cellH);
        ctx.lineTo(canvas.width, i * cellH);
        ctx.stroke();
      }
      for (let j = 0; j <= m; j++) {
        ctx.beginPath();
        ctx.moveTo(j * cellW, 0);
        ctx.lineTo(j * cellW, canvas.height);
        ctx.stroke();
      }

      // Draw visited cells (trail)
      ctx.fillStyle = 'lightblue';
      visited.forEach(cell => {
        ctx.fillRect(cell.x * cellW + 2, cell.y * cellH + 2, cellW - 4, cellH - 4);
      });

      // Draw rover
      const rover = visited[visited.length - 1]
      ctx.fillStyle = 'red';
      ctx.fillRect(rover.x * cellW + 2, rover.y * cellH + 2, cellW - 4, cellH - 4);
    }

    function stopAnimation() {
      if (animationId) {
        clearTimeout(animationId);
        animationId = null;
      }
    }

    function moveRover(instr) {
      const last = visited[visited.length - 1];
      let rover = { x: last.x, y: last.y };
      if (instr === 'G') rover.y = (rover.y - 1 + n) % n;
      if (instr === 'D') rover.y = (rover.y + 1) % n;
      if (instr === 'L') rover.x = (rover.x - 1 + m) % m;
      if (instr === 'P') rover.x = (rover.x + 1) % m;

      // Record visited cell
      visited.push({x: rover.x, y: rover.y});
    }

    function stepForward() {
      moveRover(instructions[(visited.length - 1) % instructions.length]);
    }
    function manualStepForward() {
      stopAnimation();
      stepForward();
      drawGrid()
    }
    function stepBackward() {
      if (visited.length > 1) {
          stopAnimation();
          visited.pop();
          drawGrid();
      }
    }

    function startAnimation() {
      stopAnimation();
      if (visited.length == 1) {
        n = parseInt(document.getElementById('rows').value);
        m = parseInt(document.getElementById('cols').value);
        instructions = document.getElementById('instructions').value;

        // Validation
        if (!n || !m || !instructions) {
          alert("Wszystkie pola muszą być wypełnione!");
          return;
        }
        if (n < 0 || m < 0) {
          alert("Wymiary planszy muszą być dodatnie!");
          return;
        }

        // Check instructions only contain D, G, P, L
        if (!/^[DGPL]+$/.test(instructions)) {
          alert("Instrukcje mogą zawierać tylko litery D, G, P, L!");
          return;
        }
      }
      delay = parseInt(document.getElementById('speed').value);
      animationId = setInterval(() => {
        stepForward();
        drawGrid();
      }, delay);
    }

    function resetAnimation() {
      stopAnimation();
      n = parseInt(document.getElementById('rows').value);
      m = parseInt(document.getElementById('cols').value);
      instructions = document.getElementById('instructions').value;
      delay = parseInt(document.getElementById('speed').value);
      visited = [{x: 0, y: 0}];
      drawGrid();
    }

    resetAnimation();
  </script>
</body>
</html>
